local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")

-- // TRACKERS // --
local BlockedInSession = {}
local AutoRefreshActive = false
local espActive = false
local fpsActive = false
local Camera = workspace.CurrentCamera

-- // UI SETUP // --
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "InfernoHub_Final_V2"
screenGui.ResetOnSpawn = false
screenGui.DisplayOrder = 999999
screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

local container = Instance.new("Frame")
container.Size = UDim2.new(0, 330, 0, 42)
container.Position = UDim2.new(0.5, -165, 0.3, 0) 
container.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
container.BackgroundTransparency = 0
container.Active = true
container.ClipsDescendants = true
container.Parent = screenGui

local border = Instance.new("UIStroke")
border.Thickness = 2
border.Color = Color3.fromRGB(255, 60, 0)
border.Parent = container
Instance.new("UICorner", container).CornerRadius = UDim.new(0, 10)

-- // HEADER // --
local headerText = Instance.new("TextLabel")
headerText.Size = UDim2.new(0, 120, 0, 42); headerText.Position = UDim2.new(0, 12, 0, 0)
headerText.BackgroundTransparency = 1; headerText.Text = "INFERNO HUB üî•"; headerText.TextColor3 = Color3.fromRGB(255, 100, 0)
headerText.Font = Enum.Font.GothamBold; headerText.TextSize = 13; headerText.TextXAlignment = Enum.TextXAlignment.Left; headerText.Parent = container

local premiumTag = Instance.new("TextLabel")
premiumTag.Size = UDim2.new(0, 60, 0, 42); premiumTag.Position = UDim2.new(0, 125, 0, 0)
premiumTag.BackgroundTransparency = 1; premiumTag.Text = "PREMIUM"; premiumTag.TextColor3 = Color3.fromRGB(255, 215, 0)
premiumTag.Font = Enum.Font.GothamBold; premiumTag.TextSize = 10; premiumTag.Parent = container

-- // NAVIGATION // --
local function createNav(txt, pos, color)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(0, 25, 0, 25); b.Position = pos; b.BackgroundTransparency = 1
    b.Text = txt; b.TextSize = 16; b.TextColor3 = color or Color3.new(1,1,1); b.Parent = container
    return b
end

local settingsBtn = createNav("‚öôÔ∏è", UDim2.new(1, -125, 0, 8.5))
local refreshBtn = createNav("üîÑ", UDim2.new(1, -95, 0, 8.5))
local toggleBtn = createNav("‚ñº", UDim2.new(1, -65, 0, 8.5))
local closeBtn = createNav("‚úï", UDim2.new(1, -35, 0, 8.5), Color3.fromRGB(255, 0, 0))

-- // PAGES // --
local mainPage = Instance.new("Frame")
mainPage.Size = UDim2.new(1, 0, 1, -42); mainPage.Position = UDim2.new(0, 0, 0, 42); mainPage.BackgroundTransparency = 1; mainPage.Parent = container

local settingsPage = Instance.new("Frame")
settingsPage.Size = UDim2.new(1, 0, 1, -42); settingsPage.Position = UDim2.new(1, 0, 0, 42); settingsPage.BackgroundTransparency = 1; settingsPage.Parent = container
Instance.new("UIListLayout", settingsPage).Padding = UDim.new(0, 8)
settingsPage.UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local function createSetBtn(txt)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(1, -30, 0, 40); b.BackgroundColor3 = Color3.fromRGB(20, 20, 20); b.Text = txt
    b.TextColor3 = Color3.new(1,1,1); b.Font = Enum.Font.GothamBold; b.TextSize = 11; b.Parent = settingsPage
    Instance.new("UICorner", b); local s = Instance.new("UIStroke", b); s.Color = Color3.fromRGB(255, 60, 0); s.Thickness = 1.5
    return b
end

local fBtn = createSetBtn("FPS BOOSTER: OFF")
local eBtn = createSetBtn("PLAYER ESP: OFF")
local aBtn = createSetBtn("AUTO REFRESH: OFF")

-- // BLOCK LOGIC // --
local function fastBlock()
    task.wait(0.05) 
    local v = Camera.ViewportSize
    local clickX, clickY = v.X / 2, (v.Y / 2) + 55 
    VirtualInputManager:SendMouseButtonEvent(clickX, clickY, 0, true, game, 0)
    VirtualInputManager:SendMouseButtonEvent(clickX, clickY, 0, false, game, 0)
end

-- // LIST REFRESH // --
local scroll = Instance.new("ScrollingFrame")
scroll.Size = UDim2.new(1, -16, 1, -55); scroll.Position = UDim2.new(0, 8, 0, 50); scroll.BackgroundTransparency = 1; scroll.ScrollBarThickness = 3
scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y; scroll.Parent = mainPage
Instance.new("UIListLayout", scroll).Padding = UDim.new(0, 6)

local function refresh()
    for _, v in pairs(scroll:GetChildren()) do if v:IsA("Frame") then v:Destroy() end end
    for _, p in pairs(Players:GetPlayers()) do
        if p == Players.LocalPlayer then continue end
        local row = Instance.new("Frame")
        row.Size = UDim2.new(1, -8, 0, 45); row.BackgroundColor3 = Color3.fromRGB(15, 15, 15); row.Parent = scroll
        Instance.new("UICorner", row)

        local headshot = Instance.new("ImageLabel")
        headshot.Size = UDim2.new(0, 35, 0, 35); headshot.Position = UDim2.new(0, 5, 0.5, -17.5)
        headshot.BackgroundTransparency = 1; headshot.Parent = row
        Instance.new("UICorner", headshot).CornerRadius = UDim.new(1, 0)
        
        task.spawn(function()
            local content = Players:GetUserThumbnailAsync(p.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48)
            headshot.Image = content
        end)

        local name = Instance.new("TextLabel")
        name.Size = UDim2.new(1, -130, 1, 0); name.Position = UDim2.new(0, 48, 0, 0); name.BackgroundTransparency = 1
        name.Text = p.DisplayName; name.TextColor3 = Color3.new(1, 1, 1); name.Font = Enum.Font.GothamBold; name.TextSize = 12; name.TextXAlignment = Enum.TextXAlignment.Left; name.Parent = row

        local bBtn = Instance.new("TextButton")
        bBtn.Size = UDim2.new(0, 75, 0, 30); bBtn.Position = UDim2.new(1, -80, 0.5, -15)
        
        if BlockedInSession[p.UserId] then
            bBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50); bBtn.Text = "BLOCKED"
        else
            bBtn.BackgroundColor3 = Color3.fromRGB(180, 30, 30); bBtn.Text = "BLOCK"
        end
        
        bBtn.TextColor3 = Color3.new(1,1,1); bBtn.Font = Enum.Font.GothamBold; bBtn.TextSize = 11; bBtn.Parent = row
        Instance.new("UICorner", bBtn)

        bBtn.MouseButton1Click:Connect(function()
            if not BlockedInSession[p.UserId] then
                BlockedInSession[p.UserId] = true
                StarterGui:SetCore("PromptBlockPlayer", p)
                task.spawn(fastBlock)
                bBtn.Text = "BLOCKED"; bBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            end
        end)
    end
end

-- // BLOCK ALL BUTTON WITH VISUAL FEEDBACK // --
local blockAllBtn = Instance.new("TextButton")
blockAllBtn.Size = UDim2.new(1, -16, 0, 35); blockAllBtn.Position = UDim2.new(0, 8, 0, 8)
blockAllBtn.BackgroundColor3 = Color3.fromRGB(180, 30, 30); blockAllBtn.Text = "BLOCK ALL PLAYERS"; blockAllBtn.TextSize = 12
blockAllBtn.Font = Enum.Font.GothamBold; blockAllBtn.TextColor3 = Color3.new(1,1,1); blockAllBtn.Parent = mainPage
Instance.new("UICorner", blockAllBtn)

blockAllBtn.MouseButton1Click:Connect(function()
    -- Change to Blocking state
    blockAllBtn.Text = "BLOCKING..."
    blockAllBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= Players.LocalPlayer and not BlockedInSession[p.UserId] then
            BlockedInSession[p.UserId] = true
            StarterGui:SetCore("PromptBlockPlayer", p)
            fastBlock()
            task.wait(0.2) -- Necessary delay for engine registration
        end
    end
    
    -- Change to Completed state
    blockAllBtn.Text = "ALL BLOCKED"
    refresh()
end)

-- // UI TOGGLES // --
settingsBtn.MouseButton1Click:Connect(function()
    showingSettings = not showingSettings
    local mainT = showingSettings and UDim2.new(-1, 0, 0, 42) or UDim2.new(0, 0, 0, 42)
    local settT = showingSettings and UDim2.new(0, 0, 0, 42) or UDim2.new(1, 0, 0, 42)
    TweenService:Create(mainPage, TweenInfo.new(0.2), {Position = mainT}):Play()
    TweenService:Create(settingsPage, TweenInfo.new(0.2), {Position = settT}):Play()
    settingsBtn.Text = showingSettings and "üè†" or "‚öôÔ∏è"
end)

local isOpen = false
toggleBtn.MouseButton1Click:Connect(function()
    isOpen = not isOpen
    local tSize = isOpen and UDim2.new(0, 330, 0, 350) or UDim2.new(0, 330, 0, 42)
    toggleBtn.Text = isOpen and "‚ñ≤" or "‚ñº"
    TweenService:Create(container, TweenInfo.new(0.25), {Size = tSize}):Play()
end)

fBtn.MouseButton1Click:Connect(function() fpsActive = not fpsActive; fBtn.Text = fpsActive and "FPS BOOSTER: ON ‚úÖ" or "FPS BOOSTER: OFF"; Lighting.GlobalShadows = not fpsActive end)
eBtn.MouseButton1Click:Connect(function() espActive = not espActive; eBtn.Text = espActive and "PLAYER ESP: ON ‚úÖ" or "PLAYER ESP: OFF" end)
aBtn.MouseButton1Click:Connect(function() AutoRefreshActive = not AutoRefreshActive; aBtn.Text = AutoRefreshActive and "AUTO REFRESH: ON ‚úÖ" or "AUTO REFRESH: OFF" end)

-- Background Loops
task.spawn(function()
    while task.wait(3) do
        if AutoRefreshActive then refresh() end
        if espActive then
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= Players.LocalPlayer and p.Character and not p.Character:FindFirstChild("InfernoESP") then
                    local h = Instance.new("Highlight", p.Character); h.Name = "InfernoESP"; h.FillColor = Color3.fromRGB(255,0,0)
                end
            end
        end
    end
end)

-- Dragging
local d, ds, sp
container.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then d = true; ds = i.Position; sp = container.Position end end)
UserInputService.InputChanged:Connect(function(i) if d and i.UserInputType == Enum.UserInputType.MouseMovement then local delta = i.Position - ds; container.Position = UDim2.new(sp.X.Scale, sp.X.Offset + delta.X, sp.Y.Scale, sp.Y.Offset + delta.Y) end end)
UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then d = false end end)

refreshBtn.MouseButton1Click:Connect(refresh)
closeBtn.MouseButton1Click:Connect(function() screenGui:Destroy() end)
refresh()
